# 冷库物流园区碳排放检测管理系统

## 项目简介

本项目是一个专为冷库物流园区设计的碳排放检测管理系统，旨在实时监控、分析和管理冷库运营过程中的碳排放情况，帮助企业实现碳中和目标，提升环保管理水平。

## 技术架构

- **后端**: NestJS + TypeScript + TypeORM/Prisma
- **前端**: React 18 + TypeScript + Ant Design
- **数据服务**: Python FastAPI + SQLAlchemy
- **数据库**: PostgreSQL + Redis
- **部署**: Docker + Docker Compose

## 功能模块规划

### 1. 用户认证与权限管理模块 (Auth Module)

#### 功能特性
- 用户登录/注册/登出
- 基于角色的访问控制 (RBAC)
- JWT 身份认证
- 多级权限管理 (超级管理员、园区管理员、操作员、查看者)
- 操作日志记录

#### 核心功能
- 用户管理 (增删改查)
- 角色权限配置
- 密码安全策略
- 会话管理
- 二次验证 (敏感操作)

### 2. 仪表板模块 (Dashboard Module)

#### 功能特性
- 实时碳排放总览
- 关键指标监控面板
- 数据可视化图表
- 告警信息展示
- 趋势分析

#### 核心功能
- 碳排放实时监控大屏
- 能耗统计图表
- 温度分布热力图
- 排放趋势分析
- 异常告警面板
- 设备运行状态监控

### 3. 碳排放管理模块 (Carbon Emission Module)

#### 功能特性
- 碳排放数据采集
- 排放因子管理
- 碳足迹计算
- 排放报告生成
- 减排目标管理

#### 核心功能
- **排放源管理**
  - 电力消耗监控
  - 制冷剂泄漏检测
  - 燃料消耗统计
  - 运输车辆排放
  
- **排放计算引擎**
  - 实时排放量计算
  - 历史数据分析
  - 排放因子配置
  - 计算公式管理
  
- **报告与分析**
  - 日/周/月/年度报告
  - 碳足迹分析
  - 减排效果评估
  - 对标分析

### 4. 冷库管理模块 (Warehouse Module)

#### 功能特性
- 冷库基础信息管理
- 温湿度监控
- 能耗管理
- 设备状态监控
- 区域管理

#### 核心功能
- **冷库信息管理**
  - 冷库基本信息
  - 存储区域划分
  - 温区配置管理
  - 容量管理
  
- **环境监控**
  - 实时温湿度监控
  - 温度曲线分析
  - 异常温度告警
  - 环境数据历史记录
  
- **设备管理**
  - 制冷设备监控
  - 设备运行状态
  - 维护计划管理
  - 故障预警系统
  
- **能耗分析**
  - 电力消耗统计
  - 能效比分析
  - 节能建议
  - 成本分析

### 5. 物流管理模块 (Logistics Module)

#### 功能特性
- 货物进出库管理
- 运输车辆管理
- 配送路线优化
- 物流碳排放追踪

#### 核心功能
- **货物管理**
  - 入库/出库记录
  - 货物温度要求
  - 存储位置管理
  - 库存统计
  
- **车辆管理**
  - 车辆基本信息
  - 燃料消耗记录
  - 运输路线记录
  - 车辆排放统计
  
- **配送优化**
  - 路线规划算法
  - 配送效率分析
  - 碳排放最优化
  - 成本效益分析

### 6. 数据分析模块 (Analytics Module)

#### 功能特性
- 多维度数据分析
- 预测分析
- 对比分析
- 自定义报表

#### 核心功能
- **数据挖掘**
  - 排放模式识别
  - 异常检测算法
  - 趋势预测
  - 关联分析
  
- **报表系统**
  - 自定义报表生成
  - 定时报表推送
  - 数据导出功能
  - 可视化配置

### 7. 告警与通知模块 (Alert & Notification Module)

#### 功能特性
- 实时告警监控
- 多渠道通知
- 告警规则配置
- 告警处理流程

#### 核心功能
- **告警规则引擎**
  - 阈值告警配置
  - 复合条件告警
  - 告警级别设置
  - 告警抑制策略
  
- **通知系统**
  - 邮件通知
  - 短信通知
  - 系统内消息
  - 微信/钉钉集成

### 8. 系统配置模块 (System Configuration Module)

#### 功能特性
- 系统参数配置
- 数据字典管理
- 接口配置
- 系统监控

#### 核心功能
- **基础配置**
  - 排放因子配置
  - 计量单位设置
  - 时区配置
  - 多语言设置
  
- **集成配置**
  - 第三方API配置
  - 数据源配置
  - 设备接口配置
  - 同步策略设置

## 开发计划

### 第一阶段：基础架构搭建 (2-3周)

#### Week 1-2: 项目初始化
- [ ] 项目脚手架搭建
- [ ] 开发环境配置
- [ ] 数据库设计与初始化
- [ ] 基础架构代码编写
- [ ] CI/CD 流水线配置

#### Week 3: 核心模块开发
- [ ] 用户认证模块开发
- [ ] 权限管理系统
- [ ] 基础 API 接口
- [ ] 前端路由配置
- [ ] 基础组件库搭建

### 第二阶段：核心功能开发 (4-5周)

#### Week 4-5: 仪表板与碳排放模块
- [ ] 仪表板页面开发
- [ ] 碳排放数据模型设计
- [ ] 排放计算引擎开发
- [ ] 实时数据展示
- [ ] 基础图表组件

#### Week 6-7: 冷库管理模块
- [ ] 冷库信息管理
- [ ] 温湿度监控系统
- [ ] 设备管理功能
- [ ] 环境数据采集接口
- [ ] 告警系统基础功能

#### Week 8: 物流管理模块
- [ ] 货物进出库管理
- [ ] 车辆管理系统
- [ ] 基础物流数据统计
- [ ] 运输记录管理

### 第三阶段：高级功能开发 (3-4周)

#### Week 9-10: 数据分析与报表
- [ ] 数据分析算法实现
- [ ] 报表生成系统
- [ ] 数据可视化优化
- [ ] 预测分析功能
- [ ] 自定义报表配置

#### Week 11-12: 系统优化与集成
- [ ] 告警通知系统完善
- [ ] 系统配置模块
- [ ] 性能优化
- [ ] 第三方系统集成
- [ ] Python FastAPI 数据服务集成

### 第四阶段：测试与部署 (2-3周)

#### Week 13-14: 测试阶段
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能测试
- [ ] 安全测试
- [ ] 用户验收测试

#### Week 15: 部署上线
- [ ] 生产环境部署
- [ ] 数据迁移
- [ ] 系统监控配置
- [ ] 用户培训
- [ ] 文档完善

## 技术实现要点

### 数据采集策略
- 实时数据采集 (WebSocket/SSE)
- 批量数据处理 (定时任务)
- 数据清洗与验证
- 异常数据处理

### 性能优化
- 数据库查询优化
- 缓存策略 (Redis)
- 前端虚拟滚动
- 图表性能优化
- 接口响应优化

### 安全措施
- 数据加密传输
- 敏感信息脱敏
- 操作审计日志
- 权限细粒度控制
- 防SQL注入

### 扩展性设计
- 微服务架构
- 插件化设计
- 配置化管理
- 多租户支持
- 水平扩展能力

## 项目里程碑

- **里程碑 1** (Week 3): 基础架构完成，用户认证可用
- **里程碑 2** (Week 7): 核心功能模块完成，基础监控可用
- **里程碑 3** (Week 12): 所有功能模块完成，系统集成测试通过
- **里程碑 4** (Week 15): 系统上线，用户培训完成

## 团队分工建议

### 后端开发 (2-3人)
- NestJS 核心模块开发
- 数据库设计与优化
- API 接口开发
- 系统集成

### 前端开发 (2人)
- React 页面开发
- 组件库建设
- 数据可视化
- 用户体验优化

### 数据服务开发 (1人)
- Python FastAPI 开发
- 数据分析算法
- 机器学习模型
- 数据处理优化

### 测试工程师 (1人)
- 测试用例设计
- 自动化测试
- 性能测试
- 质量保证

## 风险评估与应对

### 技术风险
- **数据采集稳定性**: 建立数据采集监控，异常自动重试
- **性能瓶颈**: 提前进行性能测试，优化关键路径
- **第三方集成**: 建立接口适配层，降低依赖风险

### 业务风险
- **需求变更**: 采用敏捷开发，快速响应需求变化
- **数据准确性**: 建立数据验证机制，多重校验
- **用户接受度**: 重视用户体验，定期收集反馈

### 项目风险
- **进度延期**: 合理评估工作量，预留缓冲时间
- **人员变动**: 建立知识文档，代码规范统一
- **质量问题**: 建立代码审查机制，完善测试流程

## 数据库设计

### 数据库架构

本系统采用 PostgreSQL 作为主数据库，Redis 作为缓存数据库。完整的数据库设计包含以下核心模块：

#### 1. 用户认证与权限管理模块 (6张表)
- `users` - 用户基本信息
- `roles` - 角色定义
- `permissions` - 权限定义
- `user_roles` - 用户角色关联
- `role_permissions` - 角色权限关联
- `audit_logs` - 操作审计日志

#### 2. 冷库管理模块 (4张表)
- `warehouses` - 冷库基本信息
- `storage_zones` - 存储区域划分
- `equipment` - 设备信息管理
- `environmental_data` - 环境监控数据 (按月分区)

#### 3. 碳排放管理模块 (4张表)
- `emission_sources` - 排放源配置
- `emission_factors` - 排放因子管理
- `carbon_emissions` - 碳排放记录 (按年分区)
- `emission_targets` - 减排目标管理

#### 4. 物流管理模块 (4张表)
- `cargo_types` - 货物类型定义
- `inventory` - 库存管理
- `vehicles` - 车辆信息
- `transport_records` - 运输记录

#### 5. 告警与通知模块 (3张表)
- `alert_rules` - 告警规则配置
- `alerts` - 告警记录
- `notifications` - 通知记录

#### 6. 系统配置模块 (2张表)
- `system_configs` - 系统配置
- `dictionaries` - 数据字典

#### 7. 数据分析与报表模块 (2张表)
- `report_templates` - 报表模板
- `report_generations` - 报表生成记录

### 关键设计特点

- **UUID主键**: 所有表使用UUID作为主键，便于分布式部署
- **软删除**: 重要业务表支持软删除，使用`deleted_at`字段
- **时间戳**: 统一的时间戳字段 `created_at`、`updated_at`
- **数据精度**: 温度精确到0.1°C，碳排放量精确到0.001吨
- **分区策略**: 大数据量表按时间分区，提高查询性能
- **索引优化**: 为常用查询字段建立合适的索引

详细的数据库设计文档请参考：[数据库设计文档](docs/database-design.md)

## API 接口规范

### 接口设计原则

本系统遵循 RESTful API 设计规范，采用统一的接口标准：

#### 统一响应格式
```typescript
// 成功响应
interface ApiResponse<T> {
  success: true;
  data: T;
  message?: string;
  timestamp: string;
}

// 分页响应
interface PaginatedResponse<T> {
  success: true;
  data: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
  timestamp: string;
}

// 错误响应
interface ApiError {
  success: false;
  error: {
    code: string;
    message: string;
    details?: any;
  };
  timestamp: string;
}
```

#### 接口路径规范
```
/api/auth/*              # 认证相关接口
/api/users/*             # 用户管理接口
/api/warehouses/*        # 冷库管理接口
/api/carbon-emissions/*  # 碳排放管理接口
/api/inventory/*         # 库存管理接口
/api/vehicles/*          # 车辆管理接口
/api/transport-records/* # 运输记录接口
/api/alerts/*            # 告警管理接口
/api/dashboard/*         # 仪表板数据接口
```

### 核心接口列表

#### 认证与用户管理
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `POST /api/auth/refresh` - 刷新令牌
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 创建用户
- `PUT /api/users/:id` - 更新用户
- `DELETE /api/users/:id` - 删除用户

#### 冷库管理
- `GET /api/warehouses` - 获取冷库列表
- `GET /api/warehouses/:id` - 获取冷库详情
- `GET /api/warehouses/:id/zones` - 获取存储区域
- `GET /api/warehouses/:id/equipment` - 获取设备列表
- `GET /api/warehouses/:id/environmental-data` - 获取环境监控数据

#### 碳排放管理
- `GET /api/carbon-emissions` - 获取碳排放记录
- `GET /api/carbon-emissions/summary` - 获取碳排放汇总
- `POST /api/carbon-emissions` - 创建碳排放记录
- `GET /api/emission-sources` - 获取排放源列表
- `GET /api/emission-factors` - 获取排放因子列表

#### 物流管理
- `GET /api/inventory` - 获取库存列表
- `POST /api/inventory` - 创建库存记录
- `GET /api/vehicles` - 获取车辆列表
- `GET /api/transport-records` - 获取运输记录

#### 告警管理
- `GET /api/alerts` - 获取告警列表
- `PUT /api/alerts/:id/acknowledge` - 确认告警
- `PUT /api/alerts/:id/resolve` - 解决告警
- `GET /api/alert-rules` - 获取告警规则
- `POST /api/alert-rules` - 创建告警规则

#### 仪表板
- `GET /api/dashboard/overview` - 获取概览数据
- `GET /api/dashboard/charts` - 获取图表数据

详细的API接口规范请参考：[API接口规范文档](docs/api-specification.md)

## Mock 数据服务

为了解决前端与后端开发的时间差问题，系统提供了完整的 Mock 数据服务。

### Mock 服务特性

- **真实数据模拟**: 使用 Faker.js 生成符合业务逻辑的测试数据
- **接口完整覆盖**: 覆盖所有核心业务接口
- **数据持久化**: 使用 LocalStorage 保存数据状态
- **环境控制**: 通过环境变量灵活开启/关闭

### 可 Mock 接口标识 🎭

#### 优先 Mock 的基础数据接口
- `GET /api/users` - 用户列表
- `GET /api/warehouses` - 冷库列表
- `GET /api/warehouses/:id/zones` - 存储区域
- `GET /api/warehouses/:id/equipment` - 设备列表
- `GET /api/emission-sources` - 排放源列表
- `GET /api/emission-factors` - 排放因子列表
- `GET /api/cargo-types` - 货物类型列表
- `GET /api/vehicles` - 车辆列表

#### 建议 Mock 的业务数据接口
- `GET /api/warehouses/:id/environmental-data` - 环境监控数据
- `GET /api/carbon-emissions` - 碳排放记录
- `GET /api/carbon-emissions/summary` - 碳排放汇总
- `GET /api/inventory` - 库存数据
- `GET /api/transport-records` - 运输记录
- `GET /api/alerts` - 告警数据
- `GET /api/dashboard/overview` - 仪表板概览
- `GET /api/dashboard/charts` - 图表数据

#### 简化 Mock 的认证接口
- `POST /api/auth/login` - 登录 (返回固定 token)
- `POST /api/auth/refresh` - 刷新令牌
- `GET /api/auth/profile` - 当前用户信息

### Mock 数据生成规则

1. **时间数据**: 使用相对时间，确保数据时效性
2. **数值数据**: 符合业务逻辑的合理范围
3. **状态数据**: 覆盖所有可能的状态值
4. **关联数据**: 保持数据间的逻辑一致性
5. **分页数据**: 支持标准分页参数

### 开发工作流程

1. **前端开发阶段**: 启用 Mock 服务，独立开发
2. **接口联调阶段**: 逐步替换为真实 API
3. **生产部署阶段**: 完全关闭 Mock 服务

详细的Mock数据规范请参考：[Mock数据规范文档](docs/mock-data-specification.md)

## 功能模块详细规划

基于上述数据库设计和接口规范，各功能模块的详细规划如下：

### 1. 用户认证与权限管理模块 (Auth Module)

#### 数据模型
- 用户信息支持多角色分配
- 基于 RBAC 的权限控制模型
- 完整的操作审计日志

#### 功能特性
- JWT 身份认证，Token 1小时过期
- 四级权限：超级管理员、园区管理员、操作员、查看者
- 敏感操作二次验证
- 完整的用户生命周期管理

#### Mock 接口支持
- ✅ 用户登录/登出 (简化验证)
- ✅ 用户列表查询
- ✅ 用户角色管理

### 2. 仪表板模块 (Dashboard Module)

#### 数据展示
- 实时碳排放总览 (最近24小时数据)
- 关键指标监控面板 (8个核心指标)
- 多维度数据可视化图表
- 实时告警信息展示

#### 图表类型
- 碳排放趋势分析 (折线图)
- 能耗统计图表 (柱状图)
- 温度分布热力图
- 告警统计饼图

#### Mock 接口支持
- ✅ 概览数据 (8个关键指标)
- ✅ 图表数据 (4种图表类型)
- ✅ 实时数据刷新模拟

### 3. 碳排放管理模块 (Carbon Emission Module)

#### 排放源管理
支持四大类排放源：
- **电力消耗**: 使用中国电网平均排放因子 0.5839 kg CO2e/kWh
- **制冷剂泄漏**: 支持多种制冷剂类型，如 R404A (GWP=3922)
- **燃料消耗**: 柴油、天然气等化石燃料
- **运输排放**: 车辆燃料消耗产生的排放

#### 计算引擎
- 活动数据 × 排放因子 = 排放量
- 支持实测、估算、缺省三种数据质量
- 排放因子可按地区和时间配置
- 自动单位换算和精度控制

#### 报告分析
- 按Scope1/2/3分类统计
- 日/周/月/年度报告生成
- 减排目标跟踪和评估
- 历史趋势对比分析

#### Mock 接口支持
- ✅ 排放记录查询 (支持多条件筛选)
- ✅ 排放汇总分析 (按源头、时间统计)
- ✅ 排放源和因子配置
- ✅ 减排目标管理

### 4. 冷库管理模块 (Warehouse Module)

#### 冷库信息管理
- 支持多园区、多冷库管理
- 地理位置信息 (经纬度)
- 存储容量和使用率统计
- 建设年份和负责人信息

#### 存储区域管理
三种区域类型：
- **冷冻区**: -25°C至-15°C，用于长期冷冻存储
- **冷藏区**: -5°C至5°C，用于短期保鲜
- **常温区**: 15°C至25°C，用于常温货物

#### 设备管理
- 制冷设备运行状态监控
- 维护计划和保修期管理
- 设备故障预警系统
- 能耗统计和效率分析

#### 环境监控
- 5分钟间隔的实时数据采集
- 温湿度、压力、CO2浓度监控
- 电力消耗实时统计
- 异常数据自动告警

#### Mock 接口支持
- ✅ 冷库基础信息 (10个示例冷库)
- ✅ 存储区域划分 (每库3-8个区域)
- ✅ 设备列表管理 (每库5-15个设备)
- ✅ 环境监控数据 (最近24小时，5分钟间隔)

### 5. 物流管理模块 (Logistics Module)

#### 货物管理
- 多温区货物分类存储
- 批次号追踪管理
- 保质期预警提醒
- 供应商信息管理

#### 车辆管理
支持多种车辆类型：
- **冷藏车**: 用于冷链运输
- **普通货车**: 用于常温运输
- **电动车**: 零排放运输工具
- **混合动力车**: 低排放运输工具

#### 运输记录
- 完整的运输轨迹记录
- 燃料消耗和排放计算
- 冷链完整性监控
- 运输效率分析

#### Mock 接口支持
- ✅ 库存管理 (多状态货物)
- ✅ 车辆信息 (多类型车辆)
- ✅ 运输记录 (包含排放计算)
- ✅ 货物类型配置

### 6. 数据分析模块 (Analytics Module)

#### 数据挖掘
- 排放模式识别算法
- 异常检测和预警
- 趋势预测分析
- 关联分析和优化建议

#### 报表系统
- 自定义报表模板
- 定时报表生成和推送
- 多格式数据导出 (PDF、Excel、CSV)
- 报表生成历史记录

#### Mock 接口支持
- ✅ 预定义报表模板
- ✅ 报表生成记录
- ✅ 数据分析结果

### 7. 告警与通知模块 (Alert & Notification Module)

#### 告警规则引擎
支持多种告警类型：
- **温度告警**: 温度超出设定范围
- **湿度告警**: 湿度异常变化
- **排放告警**: 碳排放超出目标
- **设备告警**: 设备故障或异常

#### 告警级别
- **Critical**: 严重告警，立即处理
- **High**: 高级告警，1小时内处理
- **Medium**: 中级告警，4小时内处理
- **Low**: 低级告警，当日处理

#### 通知系统
- 邮件通知 (SMTP)
- 短信通知 (SMS API)
- 系统内消息推送
- 第三方集成 (微信、钉钉)

#### Mock 接口支持
- ✅ 告警记录 (各种类型和级别)
- ✅ 告警规则配置
- ✅ 通知记录和状态

### 8. 系统配置模块 (System Configuration Module)

#### 基础配置
- 排放因子数据配置
- 计量单位设置
- 时区和语言配置
- 业务参数设置

#### 集成配置
- 第三方API接口配置
- 数据源连接配置
- 设备接口协议配置
- 数据同步策略设置

#### Mock 接口支持
- ✅ 系统配置项
- ✅ 数据字典管理
- ✅ 参数配置接口

---
